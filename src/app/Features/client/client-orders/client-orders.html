<!-- Añadimos pt-5 y mt-5 para separar del navbar fijo, y min-vh-100 para altura completa -->
<div class="container-fluid bg-dark-page min-vh-100 d-flex flex-column pt-5 mt-4">
  
  <div class="container py-4 flex-grow-1">
    
    <!-- Header de la Sección -->
    <div class="d-flex align-items-center mb-5 border-bottom border-secondary pb-3">
      <h2 class="fw-bold text-white mb-0">Historial de Compras</h2>
      @if (!isLoading() && myOrders().length > 0) {
        <span class="badge bg-primary ms-3 rounded-pill">{{ myOrders().length }} pedidos</span>
      }
    </div>

    <!-- LOADER -->
    @if (isLoading()) {
      <div class="d-flex flex-column align-items-center justify-content-center py-5" style="min-height: 50vh;">
        <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status"></div>
        <p class="mt-3 text-white-50 fs-5">Cargando tu historial...</p>
      </div>
    }

    <!-- CONTENIDO PRINCIPAL -->
    @if (!isLoading()) {
      
      <div class="row g-4">
        
        <!-- LISTA DE PEDIDOS -->
        @for (order of myOrders(); track order.id) {
          <div class="col-12 col-lg-10 mx-auto">
            <div class="card bg-dark border-secondary shadow-lg text-white mb-3 hover-shadow transition-all">
              
              <!-- Header del Pedido -->
              <div class="card-header bg-black bg-opacity-50 border-secondary d-flex flex-wrap justify-content-between align-items-center py-3">
                <div class="d-flex align-items-center gap-3">
                  <div class="bg-primary bg-opacity-10 p-2 rounded">
                    <i class="bi bi-box-seam text-primary fs-4"></i>
                  </div>
                  <div>
                    <span class="text-white-50 text-uppercase fw-bold x-small d-block">Pedido #{{ order.id }}</span>
                    <div class="d-flex align-items-center gap-2 text-white">
                      <i class="bi bi-calendar-event text-primary"></i>
                      <span class="fw-medium">{{ order.createdAt | date:'longDate' }}</span>
                    </div>
                  </div>
                </div>

                <div class="text-end mt-2 mt-md-0">
                  <div class="fw-bold fs-4 text-white mb-1">{{ order.total_amount | currency:'USD':'symbol':'1.0-0' }}</div>
                  <span class="badge rounded-pill border px-3 py-2"
                        [ngClass]="{
                          'bg-success bg-opacity-10 text-success border-success': order.status === 'paid',
                          'bg-warning bg-opacity-10 text-warning border-warning': order.status === 'pending',
                          'bg-danger bg-opacity-10 text-danger border-danger': order.status === 'cancelled'
                        }">
                    {{ order.status === 'paid' ? 'Pagado' : order.status === 'pending' ? 'Pendiente' : order.status | titlecase }}
                  </span>
                </div>
              </div>

              <!-- Cuerpo: Lista de Productos -->
              <div class="card-body bg-dark-card p-4">
                <div class="d-flex flex-column gap-3">
                  @for (item of order.items; track item.id) {
                    <div class="d-flex align-items-center p-2 rounded hover-bg-light-dark transition-all">
                      <!-- Imagen -->
                      <div class="flex-shrink-0 me-3 position-relative">
                        <img [src]="item.product?.image_url || 'assets/images/placeholder.jpg'" 
                             class="rounded border border-secondary object-fit-cover shadow-sm" 
                             width="70" height="70" alt="Producto">
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-secondary border border-dark">
                          x{{ item.quantity }}
                        </span>
                      </div>
                      
                      <!-- Info -->
                      <div class="flex-grow-1">
                        <h6 class="mb-1 fw-bold text-white">{{ item.product_name }}</h6>
                        <small class="text-primary fw-bold">{{ item.unit_price | currency:'USD':'symbol':'1.0-0' }} c/u</small>
                      </div>
                      
                      <!-- Total Item -->
                      <div class="text-end">
                        <span class="fw-bold text-white fs-6 d-block">
                          {{ item.quantity * item.unit_price | currency:'USD':'symbol':'1.0-0' }}
                        </span>
                      </div>
                    </div>
                  }
                </div>
              </div>

            </div>
          </div>
        }

        <!-- ESTADO VACÍO (Si no hay compras) -->
        @if (myOrders().length === 0) {
          <div class="col-12 d-flex justify-content-center align-items-center" style="min-height: 50vh;">
            <div class="text-center p-5 rounded-4 border border-secondary bg-black bg-opacity-25" style="max-width: 500px;">
              <div class="mb-4 d-inline-block p-4 rounded-circle bg-dark border border-secondary shadow-lg">
                <i class="bi bi-cart-x fs-1 text-secondary opacity-75" style="font-size: 3rem;"></i>
              </div>
              <h3 class="fw-bold text-white mb-3">Tu historial está vacío</h3>
              <p class="text-white-50 mb-4 px-3">
                Aún no has realizado ninguna compra. Explora nuestro catálogo de repuestos y accesorios exclusivos.
              </p>
              <a routerLink="/tienda" class="btn btn-primary px-5 py-3 rounded-pill fw-bold shadow-lg hover-scale transition-all">
                <i class="bi bi-shop me-2"></i> Ir al Catálogo
              </a>
            </div>
          </div>
        }

      </div>
      
    }
  </div>
</div>
