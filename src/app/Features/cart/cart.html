<div class="offcanvas offcanvas-end bg-black text-white border-start border-secondary border-opacity-25" tabindex="-1" id="cartOffcanvas" aria-labelledby="cartLabel">
  
  <div class="offcanvas-header border-bottom border-secondary border-opacity-25">
    <h5 class="offcanvas-title fw-bold text-uppercase ls-1" id="cartLabel">
      Tu <span class="text-orange">Carrito</span>
    </h5>
    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>

  <div class="offcanvas-body d-flex flex-column p-0">
    
    <!-- Lista de Items -->
    <div class="flex-grow-1 overflow-auto p-3 custom-scrollbar">
      
      <!-- Si hay items -->
      <ng-container *ngIf="(items$ | async) as items">
        <div *ngFor="let item of items" class="d-flex gap-3 mb-4 fade-in-up">
          
          <!-- Imagen Mini -->
          <div class="flex-shrink-0" style="width: 80px; height: 80px;">
            <img [src]="item.image_url" class="w-100 h-100 object-fit-cover rounded border border-secondary border-opacity-25" [alt]="item.name">
          </div>

          <!-- Info -->
          <div class="flex-grow-1">
            <div class="d-flex justify-content-between align-items-start">
              <h6 class="mb-0 fw-bold text-white small text-uppercase">{{ item.name }}</h6>
              <button (click)="remove(item.id)" class="btn btn-link text-danger p-0 ms-2">
                <i class="bi bi-trash"></i>
              </button>
            </div>
            <p class="text-orange fw-bold mb-2">${{ item.price | number }}</p>

            <!-- Controles Cantidad -->
<div class="d-flex align-items-center bg-dark rounded-pill border border-secondary border-opacity-25 d-inline-flex px-2 py-1">
  
  <button (click)="decrease(item.id)" class="btn btn-sm text-white py-0 px-2">-</button>
  
  <span class="mx-2 small text-white">{{ item.quantity }}</span>
  
  <!-- AQUÍ ESTÁ EL CAMBIO: [disabled] -->
  <button (click)="increase(item.id)" 
          [disabled]="item.quantity >= item.stock"
          [class.opacity-50]="item.quantity >= item.stock"
          class="btn btn-sm text-white py-0 px-2">
    +
  </button>
  
</div>

<!-- Opcional: Mostrar aviso pequeño si llegó al máximo -->
<div *ngIf="item.quantity >= item.stock" class="text-danger x-small mt-1" style="font-size: 0.7rem;">
  Máx. stock alcanzado
</div>
          </div>
        </div>

        <!-- Mensaje Vacío -->
        <div *ngIf="items.length === 0" class="text-center py-5 text-secondary opacity-50">
          <i class="bi bi-cart-x display-1"></i>
          <p class="mt-3">Tu carrito está vacío</p>
        </div>
      </ng-container>

    </div>

    <!-- Footer Total y Checkout -->
    <div class="p-4 bg-dark border-top border-secondary border-opacity-25 mt-auto">
      <div class="d-flex justify-content-between align-items-end mb-3">
        <span class="text-secondary small text-uppercase">Total a Pagar</span>
        <span class="display-6 fw-bold text-orange">${{ cartService.total | number }}</span>
      </div>
      
      <button (click)="checkout()" [disabled]="cartService.total === 0" class="btn btn-primary w-100 rounded-pill py-3 fw-bold text-uppercase shadow-lg hover-scale">
        Pagar Ahora <i class="bi bi-credit-card ms-2"></i>
      </button>
    </div>

  </div>
</div>
